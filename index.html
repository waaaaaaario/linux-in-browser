<!doctype html>
<title>Self-Hosted Linux</title>
<style>
    body { padding: 0; margin: 0; background: #000; color: #fff; }
    #screen_container {
        position: absolute;
        top: 0; bottom: 0; left: 0; right: 0;
        display: flex; justify-content: center; align-items: center;
        overflow: hidden;
    }
</style>

<div id="screen_container">
    <div style="white-space: pre; font-family: monospace;">Loading emulator...</div>
</div>

<script src="libv86.js"></script>

<script>
"use strict";

window.onload = function() {
    console.log("Loading WASM...");

    // 1. Explicitly fetch the WASM file first
    fetch("v86.wasm")
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to load v86.wasm. Check your Network tab for a 404.");
            }
            return response.arrayBuffer();
        })
        .then(() => {
            console.log("WASM loaded. Starting emulator...");
            
            // 2. Initialize emulator only after WASM is confirmed loaded
            var emulator = new V86({
                wasm_path: "v86.wasm",
                memory_size: 256 * 1024 * 1024,
                vga_memory_size: 2 * 1024 * 1024,
                screen_container: document.getElementById("screen_container"),
                bios: { url: "bios/seabios.bin" },
                vga_bios: { url: "bios/vgabios.bin" },
                cdrom: { url: "https://github.com/waaaaaaario/linux-in-browser/releases/download/OS/archlinux-2024.11.01-x86_64.iso" },
                autostart: true,
            });
        })
        .catch(err => {
            console.error(err);
            document.getElementById("screen_container").innerText = "Error: " + err.message;
        });
};
</script>
